<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="Spring Boot 分布式技术博客" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="Spring Boot 分布式技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="泽睿的自言自语">
<meta property="og:url" content="http://boot.ren/index.html">
<meta property="og:site_name" content="泽睿的自言自语">
<meta property="og:description" content="Spring Boot 分布式技术博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="泽睿的自言自语">
<meta name="twitter:description" content="Spring Boot 分布式技术博客">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> 泽睿的自言自语 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">泽睿的自言自语</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/10/Geode数据管理平台/" itemprop="url">
                Geode数据管理平台
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-11-10T21:23:08+08:00" content="2015-11-10">
            2015-11-10
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/11/10/Geode数据管理平台/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/10/Geode数据管理平台/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="概述">概述</h1><p>Geode是一个提供实时、一致访问大型分布式云平台下数据密集型应用的数据管理平台。最近开源啦！</p>
<p>Geode 通过跨多进程，把内存、CPU、网络资源和可选的本地磁盘汇集起来，来管理应用程序对象及其行为。它使用动态复制和数据分片技术，来实现高可用性，改善性能、可伸缩性和容错。Geode 除了是一个分布式数据容器，它还是一个内存数据管理系统，提供了可靠的异步事件通知和有保证的消息传递。</p>
<p>Geode 是一个非常成熟、健壮的产品，它的前身可以追溯到第一个由 Smalltalk 构造的对象数据库：GeoStone。作为一个事务性、低延迟的数据引擎，多个华尔街交易平台首次将 Geode（称为GemFire™）部署在金融部门。如今已有超过 600 家企业用户将 Geode 用于大规模、7*24 业务核心应用程序中。其中一个应用案例就是中国国家铁路将 Geode 用于整个国家的铁路票务系统，10 个节点集群管理着 2TB 的内存热数据，以及 10 个备份节点作为高可用性和弹性扩展。</p>
<h1 id="主要概念和组件">主要概念和组件</h1><p>在 Geode 分布式系统中，“缓存”是用来形容一个节点的抽象概念。</p>
<p>在每个缓存中，由您定义数据区域。数据区域（Data region）类似于关系型数据库的表，并且作为“name/value 对”以分布式方式管理数据。复制区域（replicated region）存储着 {分布式系统中每个缓存成员数据的} 相同副本。分区区域（partitioned region）在缓存成员之间传播数据。系统配置之后，客户端应用 {在不了解底层系统架构的情况下} 也可访问区域中的分布式数据。当数据发生改变的时候，您可以定义监听器来接收通知，并且您也可以定义过期条件，来删除区域中的过期数据。</p>
<p>定位器（Locator）提供发现服务和负载均衡服务。您可通过定位器服务列表来配置客户端，定位器维护着一个动态成员服务器列表。默认情况下，Geode 客户端和服务器使用40404端口，以及通过使用多播互相通信。</p>
<p>Geode 包含以下特性：</p>
<ul>
<li><p>结合冗余、复制和“非共享”的持久化架构，来实现故障安全可靠性（译者解释：高可用，防止单点故障）和性能。</p>
</li>
<li><p>可水平扩展至成千上万个缓存成员，并结合多个缓存拓扑来满足不同的企业需求。该缓存可以分布在多个计算机中。</p>
</li>
<li><p>异步和同步缓存更新传播（propagation）。</p>
</li>
<li><p>Delta 仅在一个对象（delta）新旧不同版本之间传播，而不是整个对象，从而极大降低了分发成本。</p>
</li>
<li><p>可靠的异步事件通知，优化后的、低延迟的分布层保证了消息传递。</p>
</li>
<li><p>无需额外的硬件，应用程序即可提速 4~40 倍。</p>
</li>
<li><p>数据敏感和实时业务智能。如果在您检索时数据发生更改，您能立即看到数据的变化。</p>
</li>
<li><p>与 Spring 框架集成，以加速并简化可扩展的事务型企业应用程序的开发。</p>
</li>
<li><p>支持 JTA 事务。</p>
</li>
<li><p>整个集群范围的配置，可以持久化，并可导出到其他集群。</p>
</li>
<li><p>通过 HTTP 即可实现对集群远程管理。</p>
</li>
<li><p>为 REST 应用程序开发提供 REST API 支持。</p>
</li>
<li><p>在主版本发布之间滚动升级。</p>
</li>
</ul>
<h1 id="Geode_5分钟入门">Geode 5分钟入门</h1><p>从 Pivotal 获取源文件，从源文件中提取并构建（注：目前 Geode 支持 jdk1.7.75）：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>cd geode</span><br><span class="line"><span class="variable">$ </span>./gradlew build installDist</span><br></pre></td></tr></table></figure>
<p>启动定位器和服务器：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cd gemfire-assembly/build/<span class="operator"><span class="keyword">install</span>/geode</span><br><span class="line">$ ./<span class="keyword">bin</span>/gfsh</span><br><span class="line">gfsh&gt; <span class="keyword">start</span> <span class="keyword">locator</span> <span class="comment">--name=locator</span></span><br><span class="line">gfsh&gt; <span class="keyword">start</span> <span class="keyword">server</span> <span class="comment">--name=server</span></span></span><br></pre></td></tr></table></figure>
<p>创建一个区域：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">gfsh</span>&gt; <span class="comment">create</span> <span class="comment">region</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">name=region</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">type=REPLICATE</span></span><br></pre></td></tr></table></figure>
<p>编写一个客户端应用程序：</p>
<p>HelloWorld.java</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> com.gemstone.gemfire.cache.Region;</span><br><span class="line"><span class="keyword">import</span> com.gemstone.gemfire.cache.client.*;</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">public static <span class="keyword">void</span> main(<span class="built_in">String</span>[] args) throws Exception &#123;</span><br><span class="line">ClientCache cache = <span class="keyword">new</span> ClientCacheFactory()</span><br><span class="line">.addPoolLocator(<span class="string">"localhost"</span>, <span class="number">10334</span>)</span><br><span class="line">.create();</span><br><span class="line">Region&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; region = cache</span><br><span class="line">.&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt;createClientRegionFactory(ClientRegionShortcut.CACHING_PROXY)</span><br><span class="line">.create(<span class="string">"region"</span>);</span><br><span class="line">region.put(<span class="string">"1"</span>, <span class="string">"Hello"</span>);</span><br><span class="line">region.put(<span class="string">"2"</span>, <span class="string">"World"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">Map</span>.Entry&lt;<span class="built_in">String</span>, <span class="built_in">String</span>&gt; entry : region.entrySet()) &#123;</span><br><span class="line">System.out.format(<span class="string">"key = %s, value = %sn"</span>, entry.getKey(), entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line">cache.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并运行 HelloWorld.java。classpath 中应包含 gemfire-core-dependencies.jar 包：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac -cp /some/path/geode/gemfire-assembly/build/install/geode/<span class="class"><span class="keyword">lib</span>/<span class="title">gemfire</span>-<span class="title">core</span>-<span class="title">dependencies</span>.<span class="title">jar</span> <span class="title">HelloWorld</span>.<span class="title">java</span></span></span><br><span class="line">java -cp .<span class="symbol">:/some/path/geode/gemfire-assembly/build/install/geode/lib/gemfire-core-dependencies</span>.jar <span class="constant">HelloWorld</span></span><br></pre></td></tr></table></figure>
<p>应用程序开发</p>
<p>Geode 应用程序可以用很多种客户端技术实现：</p>
<p>Java 通过使用 Geode 客户端 API，或者嵌入式使用 Geode API</p>
<p>Spring Data GemFire或 Spring Cache</p>
<p>Python（<a href="https://github.com/gemfire/py-gemfire-rest）" target="_blank" rel="external">https://github.com/gemfire/py-gemfire-rest）</a></p>
<p>REST</p>
<p>memcached<br>英文出处：Geode<br>译文出处：伯乐在线-Martin<br>译文链接：<a href="http://blog.jobbole.com/87810/" target="_blank" rel="external">http://blog.jobbole.com/87810/</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/10/nginx 的 Basic Auth 认证/" itemprop="url">
                使用nginx 实现Basic Auth认证
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-10T10:13:57+08:00" content="2015-10-10">
            2015-10-10
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/10/nginx 的 Basic Auth 认证/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/10/nginx 的 Basic Auth 认证/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="以centos_系统为例:">以centos 系统为例:</h3><p>添加httpd-tools工具<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> httpd-tools</span><br></pre></td></tr></table></figure></p>
<p>修改nginx 配置文件<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="regexp">/etc/</span>nginx<span class="regexp">/conf.d/</span><span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure></p>
<p>在server内增加<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">location</span> /basic &#123;</span><br><span class="line">    <span class="title">auth_basic</span> <span class="string">"Basic Auth"</span>; </span><br><span class="line">    <span class="title">auth_basic_user_file</span> <span class="string">"/etc/nginx/.htpasswd"</span>; </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>创建一个用户 fedora 替换成你自己的账号，回车输入密码并确认<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /etc/nginx/<span class="class">.htpasswd</span> fedora</span><br></pre></td></tr></table></figure></p>
<p>重启nginx服务<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>rc.d<span class="regexp">/init.d/</span>nginx restart</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> nginx reload</span><br></pre></td></tr></table></figure></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">service</span> nginx restart</span><br></pre></td></tr></table></figure>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/26/struts2-modelDriven高级应用/" itemprop="url">
                struts2-modelDriven高级应用
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-26T21:33:59+08:00" content="2015-08-26">
            2015-08-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/26/struts2-modelDriven高级应用/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/26/struts2-modelDriven高级应用/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>struts2 modelDriven 高级应用</p>
<p><a href="https://travis-ci.org/izerui/struts2-advanced-modelDriven" target="_blank" rel="external"><img src="https://travis-ci.org/izerui/struts2-advanced-modelDriven.svg?branch=master" alt="Build Status"></a></p>
<p>#封装的第四种Action传参方式</p>
<p>##传统的struts传参有三种</p>
<ul>
<li><ol>
<li>通过属性传参</li>
</ol>
</li>
<li><ol>
<li>通过域模型传参</li>
</ol>
</li>
<li><ol>
<li>通过模型驱动传参数</li>
</ol>
</li>
</ul>
<p>##以上这三种各有利弊,总之一句话概括,无法完全的实现业务和参数分离.总得在自己的Action中定义相关的get set 方法.</p>
<p>希望能实现参数传递跟业务action完全分离.故封装了模型驱动参数获取方式.</p>
<p>#如此一来,action 还可以这样写:</p>
<p>-Action</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YourAction</span> <span class="keyword">extends</span> <span class="title">BaseActionSupport</span>&lt;<span class="title">YourParam</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO your code ....</span></span><br><span class="line">    <span class="comment">//在需要获取request参数的地方只需要通过 formParam对象get你需要的参数即可</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>-param class 就是一个简单的po类.随你写喽!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">yourParam</span></span>&#123;</span><br><span class="line">    <span class="comment">// 各种 param fields</span></span><br><span class="line">    <span class="comment">// 各种 get set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>#OK 所有的action请求,都会自动的封装到你定义的param类中. 前提这个类要有不带参数的构造方法,要有你希望获取的参数的get set 方法.</p>
<p>其实就是把action中的各种 get set 放到了一个统一的param类中.</p>
<p>一个action  一个 param类. 是不是很清晰.业务跟参数代码分离了. struts action 是不是更易读了.</p>
<h1 id="附:_顺带将_BaseActionSupport_放入了一个applicationContext">附: 顺带将 BaseActionSupport 放入了一个applicationContext</h1><h2 id="这样所有的action_都可以直接使用applicationContext_对象,如果您不喜欢可以自行去掉-">这样所有的action 都可以直接使用applicationContext 对象,如果您不喜欢可以自行去掉.</h2><p>##步骤如下:</p>
<ul>
<li><ol>
<li>删除 protected ApplicationContext applicationContext;</li>
</ol>
</li>
<li><ol>
<li>删除 applicationContext 的 set方法</li>
</ol>
</li>
<li><ol>
<li>去掉实现的接口 ApplicationContextAware</li>
</ol>
</li>
</ul>
<p>#不过建议留着吧.</p>
<ul>
<li>当你用上 spring 的event 的时候,你会需要它.</li>
<li>当你需要动态的根据className 或者 classType 获取bean 的时候,你会需要它.</li>
<li></li>
</ul>
<p><img src="http://dl.iteye.com/upload/picture/pic/130175/017e87c4-e4a6-3da8-92c6-7502a0e84486.png" alt="图"></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/26/spring-boot监控/" itemprop="url">
                spring-boot监控
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-26T21:28:04+08:00" content="2015-08-26">
            2015-08-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/26/spring-boot监控/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/26/spring-boot监控/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="spring-boot-actuator-monitor">spring-boot-actuator-monitor</h1><p>基于spring boot的 监控平台</p>
<p>#spring-boot-admin 监控后台</p>
<ol>
<li><p>新建一个maven工程 boot-admin ， 继承 spring-boot-starter-parent</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.2.4.RELEASE<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>加入依赖</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-admin-server<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-admin-server-ui<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.googlecode.json-simple<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>json-simple<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">optional</span>&gt;</span>false<span class="tag">&lt;/<span class="title">optional</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>加入plugin 以 exec jar包运行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="title">executions</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="title">execution</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="title">goals</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="title">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="title">goal</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;/<span class="title">goals</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="title">classifier</span>&gt;</span>exec<span class="tag">&lt;/<span class="title">classifier</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="title">execution</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="title">executions</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建执行执行类   com.izerui.boot.admin.Application.java</p>
</li>
</ol>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@SpringBootApplication</span></span><br><span class="line"><span class="annotation">@EnableAdminServer</span></span><br><span class="line"><span class="annotation">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="typename">void</span> main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.<span class="keyword">class</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>声明监控后台的应用名称、端口、上下文、基本授权验证用户名、密码等信息  application.properties</li>
</ol>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application</span></span><br><span class="line">server.<span class="keyword">port</span> = <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># basic security</span></span><br><span class="line">security.ignored=/api/**</span><br><span class="line">security.<span class="keyword">user</span>.name=boot</span><br><span class="line">security.<span class="keyword">user</span>.password=boot1234</span><br></pre></td></tr></table></figure>
<ol>
<li><p>mvn install 后 执行 java -jar boot-admin-exec.jar</p>
</li>
<li><p>访问 <a href="http://主机ID:端口/boot-admin" target="_blank" rel="external">http://主机ID:端口/boot-admin</a></p>
</li>
</ol>
<hr>
<h1 id="注册应用到监控后台">注册应用到监控后台</h1><ol>
<li><p>确保应用继承 spring-boot-starter-parent</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">parent</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.2.4.RELEASE<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入依赖</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>com.googlecode.json-simple<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>json-simple<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">optional</span>&gt;</span>false<span class="tag">&lt;/<span class="title">optional</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>配置被监控的应用的名称和监控后台地址 application.properties</p>
<blockquote>
<p>jar 方式运行</p>
</blockquote>
<h1 id="web_application">web application</h1><p>   server.port=28584<br>   info.version=@pom.version@<br>   info.info=微信代理服务<br>   management.context-path=/management<br>   server.context-path=/@pom.artifactId@<br>   endpoints.jmx.domain=@pom.artifactId@<br>   spring.application.name=@pom.artifactId@</p>
<h1 id="boot_admin">boot admin</h1><p>   spring.boot.admin.url=<a href="http://192.168.1.128:8888/boot-admin" target="_blank" rel="external">http://192.168.1.128:8888/boot-admin</a></p>
<hr>
<blockquote>
<p>war 方式运行</p>
</blockquote>
<h1 id="web_application-1">web application</h1><p>   info.version=@pom.version@<br>   info.info=阿里支付服务<br>   management.context-path=/management<br>   endpoints.jmx.domain=@pom.artifactId@<br>   spring.application.name=@pom.artifactId@</p>
<h1 id="boot_admin-1">boot admin</h1><p>   spring.boot.admin.url=<a href="http://192.168.1.128:8888" target="_blank" rel="external">http://192.168.1.128:8888</a><br>   spring.boot.admin.client.service-url=<a href="http://192.168.1.106:8098/qq-pay-web" target="_blank" rel="external">http://192.168.1.106:8098/qq-pay-web</a></p>
</li>
</ol>
<pre><code>注意： 别忘了添加logging配置
<span class="comment"># LOGGING</span>
logging.<span class="type">file</span>=/tmp/logs/offline-proxy-tcp.<span class="command">log</span>

注意： 有些应用被权限框架拦截了。故需要加入 
management.context-path=/management 
并在权限框架内 将 /management/** = anon 权限放开，声明url注意上下文。
</code></pre><ol>
<li><p>配置logback的jmx接口调用</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;<span class="keyword">include</span> resource=<span class="string">"org/springframework/boot/logging/logback/base.xml"</span>/&gt;</span><br><span class="line">    &lt;jmxConfigurator/&gt;</span><br><span class="line">    &lt;logger name=<span class="string">"com.izerui"</span> level=<span class="string">"DEBUG"</span>/&gt;</span><br><span class="line">    &lt;root level=<span class="string">"INFO"</span>&gt;</span><br><span class="line">        &lt;appender-<span class="keyword">ref</span> <span class="keyword">ref</span>=<span class="string">"CONSOLE"</span> /&gt;</span><br><span class="line">        &lt;appender-<span class="keyword">ref</span> <span class="keyword">ref</span>=<span class="string">"FILE"</span> /&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布自定义jmx接口</p>
</li>
</ol>
<pre><code>在spring bean 类的头信息上增加注解 @<span class="function"><span class="title">ManagedResource</span><span class="params">(currencyTimeLimit = <span class="number">20</span>)</span></span> 和 @Lazy

声明属性： @<span class="function"><span class="title">ManagedAttribute</span><span class="params">(description = <span class="string">"当前TCP连接数"</span>)</span></span>

声明方法： @<span class="function"><span class="title">ManagedOperation</span><span class="params">(description = <span class="string">"关闭对应IP的所有连接"</span>)</span></span>
          @ManagedOperationParameters(
            @<span class="function"><span class="title">ManagedOperationParameter</span><span class="params">(name = <span class="string">"ip"</span>, description = <span class="string">"终端IP"</span>)</span></span>
          )
</code></pre><p>参考资料：</p>
<ul>
<li><p><a href="https://github.com/codecentric/spring-boot-admin.git" target="_blank" rel="external">https://github.com/codecentric/spring-boot-admin.git</a></p>
</li>
<li><p><a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-jmx.html" target="_blank" rel="external">http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-jmx.html</a></p>
</li>
<li><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-actuator" target="_blank" rel="external">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-actuator</a></p>
</li>
<li><p><a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#_auto_configured_healthindicators" target="_blank" rel="external">http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#_auto_configured_healthindicators</a></p>
</li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/26/基于redis的cas ticket共享/" itemprop="url">
                基于redis的cas ticket共享
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-26T21:18:26+08:00" content="2015-08-26">
            2015-08-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/26/基于redis的cas ticket共享/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/26/基于redis的cas ticket共享/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="实现cas_ticket基于redis的集群">实现cas ticket基于redis的集群</h1><h3 id="目的">目的</h3><pre><code>克服cas单点故障，将cas认证请求分发到多台cas服务器上，降低负载。
</code></pre><h3 id="实现思路：">实现思路：</h3><pre><code>采用统一的ticket存取策略，所有ticket的操作都从中央缓存redis中存取。
采用session共享，session的存取都从中央缓存redis中存取。
</code></pre><h3 id="前提：">前提：</h3><pre><code>这里只讲解如何实现cas ticket的共享，关于session的共享请移步：
</code></pre><ul>
<li><a href="https://github.com/izerui/tomcat-redis-session-manager" target="_blank" rel="external">https://github.com/izerui/tomcat-redis-session-manager</a></li>
</ul>
<h3 id="实现步骤：">实现步骤：</h3><ol>
<li><p>基于cas源码 新增模块 <strong>cas-server-integration-redis</strong></p>
<p> pom.xml 文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">project</span> <span class="attribute">xmlns</span>=<span class="value">"http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line">	 <span class="attribute">xmlns:xsi</span>=<span class="value">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">	 <span class="attribute">xsi:schemaLocation</span>=<span class="value">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>cas-server<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.jasig.cas<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>4.0.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="title">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>cas-server-integration-redis<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.jasig.cas<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>cas-server-core<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.jasig.cas<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>cas-server-support-saml<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="title">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- redis --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">version</span>&gt;</span>1.5.1.RELEASE<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="title">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加类到 <strong>cas-server-integration-redis</strong> 模块的 org.jasig.cas.ticket.registry 包下</p>
<p> <strong>RedisTicketRegistry.java</strong></p>
</li>
</ol>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Licensed to Jasig under one or more contributor license</span><br><span class="line"> * agreements. See the NOTICE file distributed with this work</span><br><span class="line"> * for additional information regarding copyright ownership.</span><br><span class="line"> * Jasig licenses this file to you under the Apache License,</span><br><span class="line"> * Version 2.0 (the "License"); you may not use this file</span><br><span class="line"> * except in compliance with the License.  You may obtain a</span><br><span class="line"> * copy of the License at the following location:</span><br><span class="line"> *</span><br><span class="line"> *   http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing,</span><br><span class="line"> * software distributed under the License is distributed on an</span><br><span class="line"> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span><br><span class="line"> * KIND, either express or implied.  See the License for the</span><br><span class="line"> * specific language governing permissions and limitations</span><br><span class="line"> * under the License.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> org.jasig.cas.ticket.registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jasig.cas.ticket.ServiceTicket;</span><br><span class="line"><span class="keyword">import</span> org.jasig.cas.ticket.Ticket;</span><br><span class="line"><span class="keyword">import</span> org.jasig.cas.ticket.TicketGrantingTicket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Min;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Key-value ticket registry implementation that stores tickets in redis keyed on the ticket ID.</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@author</span> Scott Battaglia</span><br><span class="line"> * <span class="doctag">@author</span> Marvin S. Addison</span><br><span class="line"> * <span class="doctag">@since</span> 3.3</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTicketRegistry</span> <span class="keyword">extends</span> <span class="title">AbstractDistributedTicketRegistry</span> <span class="keyword">implements</span> <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String TICKET_PREFIX = <span class="string">"TICKETGRANTINGTICKET:"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** redis client. */</span></span><br><span class="line">    <span class="annotation">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TicketRedisTemplate client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * TGT cache entry timeout in seconds.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Min</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> tgtTimeout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * ST cache entry timeout in seconds.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Min</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> stTimeout;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Creates a new instance using the given redis client instance, which is presumably configured via</span><br><span class="line">     * &lt;code&gt;net.spy.redis.spring.redisClientFactoryBean&lt;/code&gt;.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> client                      redis client.</span><br><span class="line">     * <span class="doctag">@param</span> ticketGrantingTicketTimeOut TGT timeout in seconds.</span><br><span class="line">     * <span class="doctag">@param</span> serviceTicketTimeOut        ST timeout in seconds.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisTicketRegistry</span><span class="params">(<span class="keyword">final</span> TicketRedisTemplate client, <span class="keyword">final</span> <span class="keyword">int</span> ticketGrantingTicketTimeOut,</span><br><span class="line">			       <span class="keyword">final</span> <span class="keyword">int</span> serviceTicketTimeOut)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.tgtTimeout = ticketGrantingTicketTimeOut;</span><br><span class="line">	<span class="keyword">this</span>.stTimeout = serviceTicketTimeOut;</span><br><span class="line">	<span class="keyword">this</span>.client = client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">updateTicket</span><span class="params">(<span class="keyword">final</span> Ticket ticket)</span> </span>&#123;</span><br><span class="line">	logger.debug(<span class="string">"Updating ticket &#123;&#125;"</span>, ticket);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="keyword">this</span>.client.boundValueOps(TICKET_PREFIX+ticket.getId()).set(ticket,getTimeout(ticket), TimeUnit.SECONDS);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">	    logger.<span class="keyword">error</span>(<span class="string">"Failed updating &#123;&#125;"</span>, ticket, e);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">addTicket</span><span class="params">(<span class="keyword">final</span> Ticket ticket)</span> </span>&#123;</span><br><span class="line">	logger.debug(<span class="string">"Adding ticket &#123;&#125;"</span>, ticket);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="keyword">this</span>.client.boundValueOps(TICKET_PREFIX+ticket.getId()).set(ticket,getTimeout(ticket),TimeUnit.SECONDS);</span><br><span class="line">	&#125;<span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">	    logger.<span class="keyword">error</span>(<span class="string">"Failed adding &#123;&#125;"</span>, ticket, e);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">deleteTicket</span><span class="params">(<span class="keyword">final</span> String ticketId)</span> </span>&#123;</span><br><span class="line">	logger.debug(<span class="string">"Deleting ticket &#123;&#125;"</span>, ticketId);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="keyword">this</span>.client.delete(TICKET_PREFIX+ticketId);</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">	    logger.<span class="keyword">error</span>(<span class="string">"Failed deleting &#123;&#125;"</span>, ticketId, e);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function">Ticket <span class="title">getTicket</span><span class="params">(<span class="keyword">final</span> String ticketId)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	    <span class="keyword">final</span> Ticket t = (Ticket) <span class="keyword">this</span>.client.boundValueOps(TICKET_PREFIX+ticketId).get();</span><br><span class="line">	    <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="function"><span class="keyword">return</span> <span class="title">getProxiedTicketInstance</span><span class="params">(t)</span></span>;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</span><br><span class="line">	    logger.<span class="keyword">error</span>(<span class="string">"Failed fetching &#123;&#125; "</span>, ticketId, e);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * &#123;<span class="doctag">@inheritDoc</span>&#125;</span><br><span class="line">     * This operation is not supported.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@throws</span> UnsupportedOperationException if you try and call this operation.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Ticket&gt; getTickets() &#123;</span><br><span class="line">	Set&lt;Ticket&gt; tickets = <span class="keyword">new</span> HashSet&lt;Ticket&gt;();</span><br><span class="line">	Set&lt;String&gt; keys = <span class="keyword">this</span>.client.keys(TICKET_PREFIX + <span class="string">"*"</span>);</span><br><span class="line">	<span class="keyword">for</span> (String key:keys)&#123;</span><br><span class="line">	    Ticket ticket = <span class="keyword">this</span>.client.boundValueOps(TICKET_PREFIX+key).get();</span><br><span class="line">	    <span class="keyword">if</span>(ticket==<span class="keyword">null</span>)&#123;</span><br><span class="line">		<span class="keyword">this</span>.client.delete(TICKET_PREFIX+key);</span><br><span class="line">	    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		tickets.add(ticket);</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tickets;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">//do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@param</span> sync set to true, if updates to registry are to be synchronized</span><br><span class="line">     * <span class="doctag">@deprecated</span> As of version 3.5, this operation has no effect since async writes can cause registry consistency issues.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Deprecated</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setSynchronizeUpdatesToRegistry</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> sync)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">boolean</span> <span class="title">needsCallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">(<span class="keyword">final</span> Ticket t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (t <span class="keyword">instanceof</span> TicketGrantingTicket) &#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">this</span>.tgtTimeout;</span><br><span class="line">	&#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(t <span class="keyword">instanceof</span> ServiceTicket)</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">this</span>.stTimeout;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Invalid ticket type"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code><span class="keyword">*</span><span class="keyword">*</span>TicketRedisTemplate.java<span class="keyword">*</span><span class="keyword">*</span>
</code></pre><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.jasig.cas.ticket.registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.jasig.cas.ticket.<span class="type">Ticket</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.<span class="type">RedisConnectionFactory</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.<span class="type">RedisTemplate</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.<span class="type">JdkSerializationRedisSerializer</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.<span class="type">RedisSerializer</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.<span class="type">StringRedisSerializer</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by serv on 2015/7/19.</span><br><span class="line"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">TicketRedisTemplate</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">RedisTemplate&lt;String</span>, <span class="title">Ticket&gt;</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    public <span class="type">TicketRedisTemplate</span>() &#123;</span><br><span class="line">	<span class="type">RedisSerializer</span>&lt;<span class="type">String</span>&gt; string = <span class="keyword">new</span> <span class="type">StringRedisSerializer</span>();</span><br><span class="line">	<span class="type">JdkSerializationRedisSerializer</span> jdk = <span class="keyword">new</span> <span class="type">JdkSerializationRedisSerializer</span>();</span><br><span class="line">	setKeySerializer(string);</span><br><span class="line">	setValueSerializer(jdk);</span><br><span class="line">	setHashKeySerializer(string);</span><br><span class="line">	setHashValueSerializer(jdk);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="type">TicketRedisTemplate</span>(<span class="type">RedisConnectionFactory</span> connectionFactory) &#123;</span><br><span class="line">	<span class="keyword">this</span>();</span><br><span class="line">	setConnectionFactory(connectionFactory);</span><br><span class="line">	afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p><strong>cas-server-webapp</strong> 添加刚才新增模块的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">groupId</span>&gt;</span>org.jasig.cas<span class="tag">&lt;/<span class="title">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">artifactId</span>&gt;</span>cas-server-integration-redis<span class="tag">&lt;/<span class="title">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="title">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 spring配置文件 <strong>cas-server-webapp</strong> 模块 WEB-INF\spring-configuration\ticketRegistry.xml</p>
<pre><code><span class="comment"><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="property">id</span>=<span class="string">"ticketRegistry"</span> <span class="type">class</span>=<span class="string">"org.jasig.cas.ticket.registry.DefaultTicketRegistry"</span> /&gt;</span><br></pre></td></tr></table></figure></span>
</code></pre><p> 替换为</p>
<pre><code><span class="comment"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ticketRegistry"</span> <span class="attribute">class</span>=<span class="value">"org.jasig.cas.ticket.registry.RedisTicketRegistry"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">index</span>=<span class="value">"0"</span> <span class="attribute">ref</span>=<span class="value">"redisTemplate"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">       <span class="comment">&lt;!-- TGT timeout in seconds --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">index</span>=<span class="value">"1"</span> <span class="attribute">value</span>=<span class="value">"1800"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">       <span class="comment">&lt;!-- ST timeout in seconds --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">constructor-arg</span> <span class="attribute">index</span>=<span class="value">"2"</span> <span class="attribute">value</span>=<span class="value">"300"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"jedisConnFactory"</span></span><br><span class="line">         <span class="attribute">class</span>=<span class="value">"org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span></span><br><span class="line">         <span class="attribute">p:hostName</span>=<span class="value">"192.168.1.89"</span></span><br><span class="line">         <span class="attribute">p:database</span>=<span class="value">"0"</span></span><br><span class="line">         <span class="attribute">p:usePool</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"redisTemplate"</span> <span class="attribute">class</span>=<span class="value">"org.jasig.cas.ticket.registry.TicketRedisTemplate"</span></span><br><span class="line">         <span class="attribute">p:connectionFactory-ref</span>=<span class="value">"jedisConnFactory"</span>/&gt;</span></span><br></pre></td></tr></table></figure></span>
</code></pre><p> 注意： 里面的 jedisConnFactory链接信息 修改为自己的连接串，这里选择database 1为存放cas票据的数据库</p>
</li>
</ol>
<ol>
<li><p>重新编译 mvn install </p>
<p>  生成的cas.war 部署到多个已经做过session共享的tomcat容器中。</p>
</li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/26/推荐一个很不错的学习android的圈子/" itemprop="url">
                推荐一个很不错的学习android的圈子
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-26T21:11:38+08:00" content="2015-08-26">
            2015-08-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/26/推荐一个很不错的学习android的圈子/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/26/推荐一个很不错的学习android的圈子/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="android-cn">android-cn</h1><p>github： <a href="https://github.com/android-cn" target="_blank" rel="external">https://github.com/android-cn</a></p>
<p>网站： <a href="http://www.codekk.com" target="_blank" rel="external">http://www.codekk.com</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/08/26/使用redis配置tomcat共享session/" itemprop="url">
                使用redis配置tomcat共享session
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-26T00:20:47+08:00" content="2015-08-26">
            2015-08-26
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/26/使用redis配置tomcat共享session/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/26/使用redis配置tomcat共享session/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h1 id="tomcat-redis-session-manager">tomcat-redis-session-manager</h1><blockquote>
<p>使用redis配置tomcat共享session</p>
</blockquote>
<h3 id="结构图：">结构图：</h3><p><img src="http://images.cnitblog.com/blog/536814/201501/301356402377480.png"></p>
<h3 id="分析：">分析：</h3><pre><code>分布式web server集群部署后需要实现session共享，针对 tomcat 服务器的实现方案多种多样，
比如 tomcat cluster session 广播、nginx <span class="constant">IP</span> hash策略、nginx sticky <span class="class"><span class="keyword">module</span>等方案，</span>
本文主要介绍了使用 redis 服务器进行 session 统一存储管理的共享方案。
</code></pre><h3 id="必要环境：">必要环境：</h3><ul>
<li>java1.7</li>
<li>tomcat7</li>
<li>redis2.8</li>
</ul>
<h2 id="nginx_负载均衡配置">nginx 负载均衡配置</h2><ol>
<li>修改nginx conf配置文件加入</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcat &#123;</span><br><span class="line">	server <span class="number">200.10</span><span class="number">.10</span><span class="number">.67</span>:<span class="number">8110</span>;</span><br><span class="line">	server <span class="number">200.10</span><span class="number">.10</span><span class="number">.67</span>:<span class="number">8120</span>;</span><br><span class="line">	server <span class="number">200.10</span><span class="number">.10</span><span class="number">.44</span>:<span class="number">8110</span>;</span><br><span class="line">	server <span class="number">200.10</span><span class="number">.10</span><span class="number">.66</span>:<span class="number">8110</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>配置 相应的server或者 location地址到 <a href="http://tomcat" target="_blank" rel="external">http://tomcat</a></li>
</ol>
<h2 id="tomcat_session共享配置步骤">tomcat session共享配置步骤</h2><ol>
<li><p>添加redis session集群依赖的jar包到 TOMCAT_BASE/lib 目录下</p>
<ul>
<li><a href="https://github.com/izerui/tomcat-redis-session-manager/blob/master/jar/tomcat-redis-session-manager-2.0.0.jar?raw=true" target="_blank">tomcat-redis-session-manager-2.0.0.jar</a></li>
<li><a href="https://github.com/izerui/tomcat-redis-session-manager/blob/master/jar/jedis-2.5.2.jar?raw=true" target="_blank">jedis-2.5.2.jar</a></li>
<li><a href="https://github.com/izerui/tomcat-redis-session-manager/blob/master/jar/commons-pool2-2.2.jar?raw=true" target="_blank">commons-pool2-2.2.jar</a></li>
</ul>
</li>
</ol>
<ol>
<li><p>修改 TOMCAT_BASE/conf 目录下的 context.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Valve</span> <span class="attribute">className</span>=<span class="value">"com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">Manager</span> <span class="attribute">className</span>=<span class="value">"com.orangefunction.tomcat.redissessions.RedisSessionManager"</span></span><br><span class="line"> <span class="attribute">host</span>=<span class="value">"localhost"</span></span><br><span class="line"> <span class="attribute">port</span>=<span class="value">"6379"</span></span><br><span class="line"> <span class="attribute">database</span>=<span class="value">"0"</span></span><br><span class="line"> <span class="attribute">maxInactiveInterval</span>=<span class="value">"60"</span></span><br><span class="line"> <span class="attribute">sessionPersistPolicies</span>=<span class="value">"PERSIST_POLICY_1,PERSIST_POLICY_2,.."</span></span><br><span class="line"> <span class="attribute">sentinelMaster</span>=<span class="value">"SentinelMasterName"</span></span><br><span class="line"> <span class="attribute">sentinels</span>=<span class="value">"sentinel-host-1:port,sentinel-host-2:port,.."</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p> 属性解释：</p>
<ul>
<li><strong>host</strong>                         redis服务器地址</li>
<li><strong>port</strong>                         redis服务器的端口号</li>
<li><strong>database</strong>                     要使用的redis数据库索引</li>
<li><strong>maxInactiveInterval</strong>         session最大空闲超时时间，如果不填则使用tomcat的超时时长，一般tomcat默认为1800 即半个小时</li>
<li><strong>sessionPersistPolicies</strong>        session保存策略，除了默认的策略还可以选择的策略有：</li>
<li><strong>[SAVE_ON_CHANGE]</strong>:每次 session.setAttribute() 、 session.removeAttribute() 触发都会保存. 注意：此功能无法检测已经存在redis的特定属性的变化，权衡：这种策略会略微降低会话的性能，任何改变都会保存到redis中.</li>
<li><strong>[ALWAYS_SAVE_AFTER_REQUEST]</strong>: 每一个request请求后都强制保存，无论是否检测到变化.注意：对于更改一个已经存储在redis中的会话属性，该选项特别有用.     权衡：如果不是所有的request请求都要求改变会话属性的话不推荐使用，因为会增加并发竞争的情况。</li>
<li><strong>sentinelMaster</strong>        redis集群主节点名称（Redis集群是以分片(Sharding)加主从的方式搭建，满足可扩展性的要求）</li>
<li><strong>sentinels</strong>                redis集群列表配置(类似zookeeper，通过多个Sentinel来提高系统的可用性)</li>
<li><strong>connectionPoolMaxTotal</strong>    </li>
<li><strong>connectionPoolMaxIdle</strong>    jedis最大能够保持idel状态的连接数</li>
<li><strong>connectionPoolMinIdle</strong>    与connectionPoolMaxIdle相反</li>
<li><strong>maxWaitMillis</strong>    jedis池没有对象返回时，最大等待时间</li>
<li><strong>minEvictableIdleTimeMillis</strong></li>
<li><strong>softMinEvictableIdleTimeMillis</strong></li>
<li><strong>numTestsPerEvictionRun</strong></li>
<li><strong>testOnCreate</strong></li>
<li><strong>testOnBorrow</strong>    jedis调用borrowObject方法时，是否进行有效检查</li>
<li><strong>testOnReturn</strong>    jedis调用returnObject方法时，是否进行有效检查</li>
<li><strong>testWhileIdle</strong></li>
<li><strong>timeBetweenEvictionRunsMillis</strong></li>
<li><strong>evictionPolicyClassName</strong></li>
<li><strong>blockWhenExhausted</strong></li>
<li><strong>jmxEnabled</strong></li>
<li><strong>jmxNameBase</strong></li>
<li><strong>jmxNamePrefix</strong></li>
</ul>
</li>
<li><p>重启tomcat，session存储即可生效</p>
</li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/04/07/zookeeper 数据浏览器/" itemprop="url">
                zookeeper 数据浏览器
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-04-07T22:20:57+08:00" content="2015-04-07">
            2015-04-07
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/04/07/zookeeper 数据浏览器/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/07/zookeeper 数据浏览器/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>又是一个清明小长假，一个人远在深圳也没有回家，闲来无事写了一个zookeeper的数据浏览器。<br>上图：</p>
<p> <img src="https://raw.githubusercontent.com/izerui/zookeeper-explorer/master/src/main/resources/public/assets/img/sample.png"></p>
<p>使用上的技术：</p>
<ol>
<li>spring boot </li>
<li>flex</li>
<li>zookeeper curator client</li>
<li>shiro security</li>
<li>fastxml jackson </li>
<li>spring mvc restful</li>
</ol>
<p>基于spring boot微服务做的一个应用，以 独立jar包发布，内嵌了tomcat容器。因为一直也没有找到合适的可以方便管理和查看 zookeeper 数据的一个东东。就自己做了一个，方便公司的zk管理。</p>
<p>有兴趣的。或者也有同样需求的可以down下来玩玩。 东西虽小五张俱全。操作权限该有的都有。</p>
<p>项目地址： <a href="https://github.com/izerui/zookeeper-explorer" target="_blank" rel="external">https://github.com/izerui/zookeeper-explorer</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/11/25/ObjectHandles2-升级版-增加鼠标样式-拖动样式/" itemprop="url">
                ObjectHandles2 升级版, 增加鼠标样式,拖动样式
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-11-25T22:26:56+08:00" content="2013-11-25">
            2013-11-25
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2013/11/25/ObjectHandles2-升级版-增加鼠标样式-拖动样式/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2013/11/25/ObjectHandles2-升级版-增加鼠标样式-拖动样式/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>效果如图:</p>
<p><img src="http://dl2.iteye.com/upload/attachment/0091/5355/63135695-596a-3162-b4db-7267a77248c5.png"></p>
<p><img src="http://dl2.iteye.com/upload/attachment/0091/5357/7841d234-7ae5-317a-874d-328b7b721563.png"></p>
<h3 id="ObjectHandles2-swc_由flex_sdk_3-5_编译">ObjectHandles2.swc  由flex sdk 3.5 编译</h3><p>官方源码+修改后的源码. </p>
<p>请移步: </p>
<p> <a href="https://github.com/izerui/ObjectHandles" target="_blank" rel="external">https://github.com/izerui/ObjectHandles</a></p>
<p> <a href="/files/ObjectHandles2.rar">ObjectHandles2.rar</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2013/11/24/flex-区域-鼠标画矩形选择组件/" itemprop="url">
                flex 区域,鼠标画矩形选择组件 
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-11-24T21:49:17+08:00" content="2013-11-24">
            2013-11-24
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2013/11/24/flex-区域-鼠标画矩形选择组件/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2013/11/24/flex-区域-鼠标画矩形选择组件/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>网上类似的代码也不少.但是都只是自己工程中单独贴出来的代码片段. 并不适合通用场景,存在很多bug<br>举个例子:</p>
<ol>
<li>如果画框所属的父组件存在滚动的条. 获取的矩形区域大小和坐标就会错乱</li>
<li>如果画矩形过程中,鼠标移出目标组件, 该矩形事件无法继续传播,等等.一些bug</li>
</ol>
<p>今天我把自己工程画框单独剥离出来成一个组件调用.</p>
<p>如下图:</p>
<p><img src="http://dl2.iteye.com/upload/attachment/0091/5073/17b5bc9d-e217-330e-9d31-9cefa400c02b.png"></p>
<p>下面是一个demo工程代码,及整个源码提供大家下载</p>
<p><a href="/files/RectangleDraw.rar">RectangleDraw.rar</a> </p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="https://github.com/izerui"><img class="site-author-image" src="https://avatars0.githubusercontent.com/u/1773233?v=3&s=460" alt="serv" itemprop="image"/></a>
          <p class="site-author-name" itemprop="name">serv</p>
        </div>
        <p class="site-description motion-element" itemprop="description">Spring Boot 分布式技术博客</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">20</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">serv</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1256526924'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1256526924%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>

 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"izerui"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
